
function TransformsController($model)
{var _self=this;var _model;var _demo={};var _mobile=false;this.name="TransformsController";this.blowup=new signals.Signal();this.init=function()
{var css_file='css/demos/'+_model.data.controller+'.css';if(!$('#style-'+_model.data.controller).length)
{$.ajax({url:css_file,success:function($css)
{$('<style id="style-'+_model.data.controller+'">'+$css+'</style>').appendTo('head');cssLoaded();}});}
else
{cssLoaded();}};this.stop=function()
{_demo={};_demo.skew=0;_demo.rotate=0;$('#demo-html').html('');};this.updateValue=function($control)
{if(jQuery.browser.mobile)
{if($control.type==='sliderup')
{if($control.id==='skew')
{skewUpdate({object:{value:$control.value}});}
if($control.id==='rotate')
{rotateUpdate({object:{value:$control.value}});}}}
else
{if($control.id==='skew')
{skewUpdate($control);}
if($control.id==='rotate')
{rotateUpdate($control);}}
_model.checkMasterAchievement(_model.data.controller);};function cssLoaded()
{if(!_model.checkFeatureCompatibility())
{_model.featureNotSupported(['CSS3 Transforms']);return;}
_mobile=jQuery.browser.mobile;_demo.object=$('#asset-tnt')[0];_demo.skew=0;_demo.rotate=0;_demo.blown_up=false;_demo.start=false;_demo.central_brick={x:634,y:343};_demo.cubes={};if(_mobile)
{setTimeout(booom,100);}else
{setTimeout(booom,1500);}}
function booom()
{$('#asset-tnt .cube').each(function()
{if(_demo.cubes!==undefined&&_demo.cubes[$(this).index()]===undefined)
{_demo.cubes[$(this).index()]={id:$(this).attr('id'),position_old:{x:Number($(this).css('left').replace('px','')),y:Number($(this).css('top').replace('px','')),z:Number($(this).css('z-index'))}}}
if(!_mobile)
{cubeUpdate($(this).index());}
else
{var idx=$(this).index();setTimeout(function()
{cubeBlowUp(idx);},4100);}});setTimeout(function()
{$('#asset-handle').css('-webkit-transition','all 0.6s ease-in').css('-webkit-transform','translateY(98px)').css('-moz-transition','all 0.6s ease-in').css('-moz-transform','translate(0, 98px)').css('-o-transition','all 0.6s ease-in').css('-o-transform','translate(0, 98px)').css('-ms-transition','all 0.6s ease-in').css('-ms-transform','translate(0, 98px)').css('transition','all 0.6s ease-in').css('transform','translate(0, 98px)')
setTimeout(function()
{if(!jQuery.browser.mobile)
{fuseIgnite(0);}
else
{$('#asset-fuse .cube').css({opacity:0});}},600);},600);setTimeout(function()
{_self.blowup.dispatch();},5000);if(_demo.blown_up)
{_demo.blown_up=false;}
else
{_demo.blown_up=true;}}
function cubeBlowUp($index)
{if(_demo.cubes!==undefined)
{var cube=_demo.cubes[$index];cube.rotate=_demo.rotate;cube.scale=randomRange(0.2,1.2,4);cube.skew=_demo.skew;cube.direction={x:cube.position_old.x-_demo.central_brick.x,y:cube.position_old.y-_demo.central_brick.y}
cube.distance=0.5+mapRange(pointsDistance(cube.position_old.x,cube.position_old.y,_demo.central_brick.x,_demo.central_brick.y),0,130,8,3);cube.position_new={x:cube.position_old.x+(cube.direction.x*cube.distance),y:cube.position_old.y+(cube.direction.y*cube.distance)}
var transform={skewX:cube.skew+'deg',skewY:0+'deg',rotate:cube.rotate+'deg',translateX:randomRange(-cube.distance*10,cube.distance*10)+'px',translateY:randomRange(-cube.distance*10,cube.distance*10)+'px',scaleX:cube.scale,scaleY:cube.scale}
if(!_mobile)
{$('#asset-tnt .cube:eq('+$index+')').css('-webkit-transition','all '+randomRange(0.9,1,1)+'s cubic-bezier(0.770, 0.030, 0.075, 0.970)').css('-moz-transition','all '+randomRange(0.9,1,1)+'s cubic-bezier(0.770, 0.030, 0.075, 0.970)').css('-o-transition','all '+randomRange(0.9,1,1)+'s cubic-bezier(0.770, 0.030, 0.075, 0.970)').css('-ms-transition','all '+randomRange(0.9,1,1)+'s cubic-bezier(0.770, 0.030, 0.075, 0.970)').css('transition','all '+randomRange(0.9,1,1)+'s cubic-bezier(0.770, 0.030, 0.075, 0.970)').css({left:cube.position_new.x,top:cube.position_new.y}).transform(transform,{preserve:true});}else
{$('#asset-tnt .cube:eq('+$index+')').css({left:cube.position_new.x,top:cube.position_new.y}).transform(transform,{preserve:true});}
if(jQuery.browser.safari)
{setTimeout(function()
{_resetCube($index);},1000);}}}
function _resetCube($index)
{$('#asset-tnt .cube:eq('+$index+')').css('-webkit-transition','all 0s cubic-bezier(0.770, 0.030, 0.075, 0.970)').css('-moz-transition','all 0s cubic-bezier(0.770, 0.030, 0.075, 0.970)').css('-o-transition','all 0s cubic-bezier(0.770, 0.030, 0.075, 0.970)').css('-ms-transition','all 0s cubic-bezier(0.770, 0.030, 0.075, 0.970)').css('transition','all 0s cubic-bezier(0.770, 0.030, 0.075, 0.970)')};function cubemoveBack($index)
{var cube=_demo.cubes[$index];var transform={skewX:0+'deg',skewY:0+'deg',rotate:0+'deg',translateX:0+'px',translateY:0+'px',scaleX:1,scaleY:1}
$('#asset-tnt .cube:eq('+$index+')').css('-webkit-transition','all '+randomRange(0,0.8,1)+'s cubic-bezier(0.435, 0.400, 0.010, 1.000)').css('-moz-transition','all '+randomRange(0,0.8,1)+'s cubic-bezier(0.435, 0.400, 0.010, 1.000)').css('-o-transition','all '+randomRange(0,0.8,1)+'s cubic-bezier(0.435, 0.400, 0.010, 1.000)').css('-ms-transition','all '+randomRange(0,0.8,1)+'s cubic-bezier(0.435, 0.400, 0.010, 1.000)').css('transition','all '+randomRange(0,0.8,1)+'s cubic-bezier(0.435, 0.400, 0.010, 1.000)').transform(transform,{preserve:true}).css({left:cube.position_old.x,top:cube.position_old.y});fuseRestore();}
function cubeUpdate($index)
{var timeline=0;if(_demo.first_run)
{_demo.first_run=false;}
else
{cubemoveBack($index);timeline+=2000;}
setTimeout(function()
{$('#asset-tnt .cube:eq('+$index+')').css('-webkit-transition','none').css('-moz-transition','none').css('-o-transition','none').css('-ms-transition','none').css('transition','none').css({backgroundPositionY:-112})},timeline);timeline+=300;setTimeout(function()
{$('#asset-tnt .cube:eq('+$index+')').css({backgroundPositionY:-84});},timeline);timeline+=300;setTimeout(function()
{$('#asset-tnt .cube:eq('+$index+')').css('-webkit-transition','none').css('-moz-transition','none').css('-o-transition','none').css('-ms-transition','none').css('transition','none').css({backgroundPositionY:-112})},timeline);timeline+=300;setTimeout(function()
{$('#asset-tnt .cube:eq('+$index+')').css({backgroundPositionY:-84});},timeline);timeline+=300;setTimeout(function()
{$('#asset-tnt .cube:eq('+$index+')').css('-webkit-transition','none').css('-moz-transition','none').css('-o-transition','none').css('-ms-transition','none').css('transition','none').css({backgroundPositionY:-112})},timeline);timeline+=300;setTimeout(function()
{$('#asset-tnt .cube:eq('+$index+')').css({backgroundPositionY:-84});},timeline);timeline+=300;timeline+=2400;setTimeout(function()
{cubeBlowUp($index)},timeline);}
function skewUpdate($control)
{
	var v = ($control.object)?$control.object.value:$control.value;
	if(v)
{_demo.skew=v;showChanges();}}
function rotateUpdate($control)
{
	var v = ($control.object)?$control.object.value:$control.value;
	if(v)
{_demo.rotate=v;showChanges();}}
function fuseIgnite($index)
{if($index<$('#asset-fuse .cube').length)
{$('#asset-fuse .cube:eq('+Number($('#asset-fuse .cube').length-$index)+')').css({opacity:0});setTimeout(function()
{fuseIgnite($index+1);},20);}
else
{$('#fuse-18').css({opacity:0});}}
function fuseRestore()
{$('#asset-fuse .cube').css({opacity:1});}
function showChanges()
{if(_demo.blown_up)
{$('#asset-tnt .cube').each(function()
{$(this).transform({rotate:_demo.rotate+'deg',skewX:_demo.skew+'deg'},{preserve:true});});}}
function randomRange($min,$max,$digits)
{var random_value=$min+(Math.random()*($max-$min));if($digits===undefined)
{random_value=Math.round(random_value)}
else
{random_value=random_value.toFixed($digits);}
return random_value;}
function mapRange($value,$low_1,$high_1,$low_2,$high_2)
{return $low_2+($high_2-$low_2)*($value-$low_1)/($high_1-$low_1);}
function pointsDistance($x_1,$y_1,$x_2,$y_2)
{var dx=$x_1-$x_2;var dy=$y_1-$y_2;return Math.sqrt((dx*dx)+(dy*dy));}
(function(){_model=$model;})();return ExpressiveWeb.create(_self,{register:true,extend:'Controller'});};