
function AudioController($model)
{var _self=this;var _model;var _demo={};this.name="AudioController";this.audioEnded=new signals.Signal();this.init=function()
{var css_file='css/demos/'+_model.data.controller+'.css';if(!$('#style-'+_model.data.controller).length)
{$.ajax({url:css_file,success:function($css)
{$('<style id="style-'+_model.data.controller+'">'+$css+'</style>').appendTo('head');cssLoaded();}});}
else
{cssLoaded();}}
function cssLoaded()
{if(!_model.checkFeatureCompatibility())
{_model.featureNotSupported(['HTML5 Audio']);return;}
var drum_kit=['clap','boo','cheer','laugh'];_demo.audio=[];var audio;for(var i=0;i<drum_kit.length;i++)
{audio=$('<audio id="audio-'+i+'" preload="auto"><source src="'+BASEURL+'audio/'+drum_kit[i]+'.ogg" type="audio/ogg" /><source src="'+BASEURL+'audio/'+drum_kit[i]+'.mp3" type="audio/mpeg" /></audio>');audio.appendTo('#demo-html');_demo.audio[i]={file:audio[0],loaded:false,playing:false,name:drum_kit[i]}
_demo.audio[i].file.load();var audio_tmp=_demo.audio[i];_demo.audio[i].file.addEventListener('canplaythrough',function(){audioLoaded(this);},false);}};this.stop=function()
{$('#overlay-audio .control.active').removeClass('active');if(_demo.audio)
{for(var i=0;i<_demo.audio.length;i++)
{if(_demo.audio[i])
{if(_demo.audio[i].file)
{if(_demo.audio[i].file.currentTime)
{_demo.audio[i].file.currentTime=0;}
_demo.audio[i].file.pause();}
_demo.audio[i].playing=false;}}}
_demo={};$('#demo-html').html('');};this.updateValue=function($control)
{var name=$control.id;var audio;if(_demo.audio){for(var i=0;i<_demo.audio.length;i++)
{if(_demo.audio[i].name===name)
{audio=_demo.audio[i];if(jQuery.browser.ipad||jQuery.browser.iphone)
{if(!audio.loaded)
{audio.loaded=true;audio.file.load();audioPlayPause(audio);}else
{audioPlayPause(audio);}
return;}}}}
if(audio!==undefined)
{audioPlayPause(audio);}};function audioLoaded($file)
{var audio;if(_demo.audio)
{for(var i=0;i<_demo.audio.length;i++)
{if(_demo.audio[i].file===$file)
{audio=_demo.audio[i];}}}
if(audio)
{audio.loaded=true;if(audio.file)
{$(audio.file).bind('ended',function(){audioEnded(audio);});}}}
function audioPlayPause($audio)
{if(_demo.audio&&$audio.playing===false&&$audio.loaded===true)
{for(var i=0;i<_demo.audio.length;i++)
{if(_demo.audio[i]!==$audio&&_demo.audio[i].playing===true)
{_demo.audio[i].file.currentTime=0;_demo.audio[i].file.pause();_demo.audio[i].playing=false;$('#control-audio-'+_demo.audio[i].name).removeClass('active');}}
$audio.file.play();$audio.playing=true;}
else
{if($audio.playing===true&&$audio.loaded===true)
{$audio.file.pause();_lastClicked=$audio.name;$audio.playing=false;_self.audioEnded.dispatch($audio.name);}}}
function audioEnded($audio)
{if($audio.loaded===true&&$audio.playing===true)
{$audio.playing=false;_self.audioEnded.dispatch($audio.name);}
if($('#control-audio-'+$audio.name).hasClass('active'))
{$('#control-audio-'+$audio.name).removeClass('active');}}
(function(){_model=$model;})();return ExpressiveWeb.create(_self,{register:true,extend:'Controller'});};